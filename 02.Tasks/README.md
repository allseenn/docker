# Контейнеризация

GeekBrains

Ростислав Ромашин

группа 4992

## Урок 2. Механизмы контрольных групп

#### Задание 1:

1. запустить контейнер с ubuntu, используя механизм LXC
2. ограничить контейнер 256 Мб ОЗУ и проверить, что ограничение работает
   Оценка Отлично

#### Задание 2*:

настроить автоматическую маршрутизацию между контейнерами. Адреса можно взять: 10.0.12.0/24 и 10.0.13.0/24. e.x. sudo lxc-create -n test123 -t ubuntu -f /usr/share/doc/lxc/examples/lxc-veth.conf (файл может леэат ьпо другому путь, можно найти командой sudo find / -name lxc-veth.conf)
Выполнять не обязательно

Задание со звездочкой - повышенной сложности, это нужно учесть при выполнении (но сделать его необходимо).

### Решение

Прежде чем приступить к выполнению заданий, необходимо установить *lxc*

```
apt install lxc-utils lxc-templates
```

<img src=pics/01.png>

Так же, необходимо скачать файлы примеров с оф.гита https://github.com/lxc/lxc/tree/main/doc/examples и поместить в директорию */usr/share/doc/lxc/examples*

#### Задача 1.1

Установим два экземпляра *ubuntu*

```
lxc-create -n test123 -t ubuntu -f /usr/share/doc/lxc/examples/lxc-veth.conf.in
lxc-create -n test123 -t ubuntu -f /usr/share/doc/lxc/examples/lxc-veth.conf.in
```

Приведенные выше команды установят системы из шаблона *ubuntu*, использую конфигурационный файл *lxc-veth.conf.in*

Запуск инстанса осуществляется командой

```
lxc-start -d -n test123
```

При запуске, для отладки, можно задать фалы для логирования

```
lxc-start -d -n test456 --logfil /var/log/test123.log --logpriority DEBUG
```

<img src=pics/02.png>

```
lxc-ls -f
```

Вышеприведенныая команда выводит информацию о виртуальных машинах.

Из картинки видим, что два экземпляра имеют статус RUNNING

Дополнительную информацию о процессе запуска можно получить из логов

```
tail /var/log/test123.log
```

#### Задача 1.2

Настроим конфиг для *test123*

```
vim /var/lib/lxc/test123/config
```

<img src=pics/03.png>

Настроим конфиг для *test456*

```
vim /var/lib/lxc/test123/config
```

<img src=pics/04.png>

Подсоединяемся к терминалам наших виртуальных машин

```
lxc-attach -n test123
lxc-attach -n test456
```

<img src=pics/05.png>

Убеждаемся что указанный параметр в конфиге ограничил оперативную память на обеих машинах до 256М

```
free -m
```

<img src=pics/06.png>

#### Задача 2

Убеждаемся в работоспособности сети

<img src=pics/06.png>

На каждой машине на один сетевой интерфейс назначено по два адреса
Один присвоился автоматически через DHCP, а второй мы статически указали в конфигах

<img src=pics/07.png>

Данные адреса отображаются в выводе информации о запущенных системах

```
lxc-ls -f
```

Также отображается *AUTOSTART 1*, это говорит, что наши виртуальные системы будут запускаться автоматически вместе запуском основной системы.
